# Claude Skills Clone - 架构说明

## 🎯 设计理念

这是一个**通用的技能管理框架**，main.py是完全通用的，不包含任何具体业务逻辑。所有的业务逻辑都由SKILL.md文件来指导AI完成。

## 📐 架构原理

### 核心组件

```
用户请求
    ↓
main.py (通用框架)
    ↓
Function Calling (3个工具)
    ├─ list_skills_catalog    - 列出所有技能索引
    ├─ get_skill_content      - 获取技能完整内容
    └─ execute_python_code    - 执行AI生成的代码
    ↓
SKILL.md (业务逻辑)
    ↓
AI根据SKILL.md指导生成代码
    ↓
执行代码完成任务
```

### 工作流程

1. **用户发送请求**
   ```
   用户：帮我做个介绍深圳的PPT
   ```

2. **main.py启动通用流程**
   - 调用`chat_with_skills(user_message)`
   - 提供3个工具给AI：
     - `list_skills_catalog` - 列出技能目录
     - `get_skill_content` - 获取技能内容
     - `execute_python_code` - 执行代码

3. **AI自主判断和调用**
   ```python
   # AI的思考过程：
   # 1. 用户要做PPT，我先看看有什么技能
   list_skills_catalog() 
   # 返回: [{"name": "pptx", "description": "创建和编辑演示文稿..."}]
   
   # 2. 有pptx技能，获取详细内容
   get_skill_content(name="pptx")
   # 返回: SKILL.md的完整Markdown内容
   
   # 3. 根据SKILL.md的指导生成代码
   execute_python_code(code="...")
   ```

4. **SKILL.md指导AI**
   - ✅ 判断是公司汇报还是普通PPT
   - ✅ 提取用户需求的内容
   - ✅ 生成完整的Python代码
   - ✅ 调用`generate_ppt_from_json.py`脚本
   - ✅ 返回生成结果

## 🔑 关键特性

### 1. main.py是完全通用的

```python
@app.post("/api/chat")
async def chat(request: ChatRequest):
    """对话接口 - 通用技能路由"""
    # ✅ 没有任何if判断
    # ✅ 没有任何硬编码的业务逻辑
    # ✅ 完全由AI和SKILL.md控制
    result = chat_with_skills(request.message)
    return ChatResponse(**result)
```

### 2. SKILL.md包含完整的业务逻辑

```markdown
## ⚡ 快速指南：如何生成PPT

### 步骤1：判断PPT类型
根据用户消息判断是"公司汇报类"还是"普通PPT"：
- 公司汇报类：包含"公司汇报"、"述职"、"转正"等关键词
- 普通PPT：其他所有情况

### 步骤2：提取用户需求
从用户消息中提取主标题、副标题、内容要点...

### 步骤3：生成代码并执行
使用execute_python_code工具执行代码模板...
```

### 3. 扩展性强

添加新技能只需：
1. 在`skills_storage/`下创建新文件夹
2. 编写`SKILL.md`文件（YAML frontmatter + Markdown）
3. **无需修改main.py**

## 📦 技能结构

```
skills_storage/
├── pptx/                    # PPT技能
│   ├── SKILL.md            # ✅ 包含所有业务逻辑
│   ├── temple/             # 资源文件夹
│   │   └── logo1.png
│   └── scripts/
├── pdf/                     # 未来可以添加PDF技能
│   └── SKILL.md
└── word/                    # 未来可以添加Word技能
    └── SKILL.md
```

### SKILL.md格式

```markdown
---
name: pptx                   # 技能名称
description: "创建和编辑..."  # 技能描述（AI用来判断是否匹配）
tags: ["presentation", "office"]  # 可选标签
---

# 技能标题

## 快速指南
- 步骤1：如何判断...
- 步骤2：如何提取...
- 步骤3：如何生成代码...

## 代码模板
```python
# 完整的可执行代码
...
\```

## 示例
...
```

## 🎪 对比：修改前 vs 修改后

### ❌ 修改前（错误架构）

```python
# main.py - 硬编码了PPT逻辑
@app.post("/api/chat")
async def chat(request: ChatRequest):
    # ❌ 硬编码判断
    if any(keyword in request.message for keyword in ["PPT", "ppt"]):
        result = handle_ppt_generation(request.message)  # ❌ 专门的处理函数
        return ChatResponse(**result)
    ...

def handle_ppt_generation(user_message: str) -> dict:
    # ❌ 100多行硬编码的PPT生成逻辑
    # ❌ 判断是否为公司汇报
    # ❌ 提取内容
    # ❌ 调用脚本
    ...
```

**问题**：
- ❌ 每添加一个技能就要修改main.py
- ❌ 业务逻辑分散在main.py和SKILL.md两处
- ❌ 难以维护和扩展

### ✅ 修改后（正确架构）

```python
# main.py - 完全通用
@app.post("/api/chat")
async def chat(request: ChatRequest):
    # ✅ 一行代码，完全通用
    result = chat_with_skills(request.message)
    return ChatResponse(**result)
```

```markdown
# SKILL.md - 包含所有业务逻辑
## 快速指南：如何生成PPT
### 步骤1：判断PPT类型
### 步骤2：提取用户需求
### 步骤3：生成代码并执行

### 示例1：普通PPT
\```python
ppt_data = {...}
cmd = [sys.executable, 'generate_ppt_from_json.py', 'ppt_data.json']
# 不添加logo
\```

### 示例2：公司汇报PPT
\```python
ppt_data = {...}
cmd = [sys.executable, 'generate_ppt_from_json.py', 'ppt_data.json']
cmd.append('--add-logo')  # 添加logo
\```
```

**优势**：
- ✅ main.py永远不需要修改
- ✅ 所有业务逻辑在SKILL.md中
- ✅ 易于添加新技能
- ✅ 符合单一职责原则

## 🚀 如何添加新技能

假设要添加PDF生成技能：

1. **创建技能文件夹**
   ```bash
   mkdir skills_storage/pdf
   ```

2. **编写SKILL.md**
   ```markdown
   ---
   name: pdf
   description: "创建和编辑PDF文档。当用户需要生成报告、文档时使用"
   ---
   
   # PDF文档生成
   
   ## 快速指南
   当用户需要生成PDF时：
   1. 提取用户需求
   2. 使用以下代码模板...
   
   \```python
   from reportlab.pdfgen import canvas
   ...
   \```
   ```

3. **完成！无需修改main.py**

AI会自动：
- 发现新的pdf技能
- 在合适的时候调用它
- 根据SKILL.md的指导生成代码

## 🎯 总结

这个架构的核心思想是：

> **main.py是框架，SKILL.md是大脑**
> 
> - main.py提供基础能力（加载技能、调用AI、执行代码）
> - SKILL.md告诉AI如何思考和操作
> - AI根据SKILL.md的指导完成具体任务

这样的设计：
- ✅ 符合开闭原则（对扩展开放，对修改关闭）
- ✅ 易于维护和测试
- ✅ 可以无限扩展技能
- ✅ 业务逻辑清晰集中

## 📚 相关文档

- `main.py` - 通用框架实现
- `skills_storage/pptx/SKILL.md` - PPT技能定义
- `generate_ppt_from_json.py` - PPT生成脚本
- `README.md` - 项目使用说明

